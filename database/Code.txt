
-- Enable PostGIS (includes raster)
CREATE EXTENSION postgis;
-- Enable Topology
CREATE EXTENSION postgis_topology;
-- fuzzy matching needed for Tiger
CREATE EXTENSION fuzzystrmatch;
-- Enable US Tiger Geocoder
CREATE EXTENSION postgis_tiger_geocoder;

CREATE TABLE tipo_sensor
(
nombre varchar(15) not null unique,
PRIMARY KEY(nombre)
);

CREATE TABLE sensor
(
id_sensor varchar(10),
nombre varchar(30) not null,
descripcion varchar(300) null,
tipo varchar(15) not null,
PRIMARY KEY(id_sensor),
FOREIGN KEY(tipo) REFERENCES tipo_sensor(nombre)
);

CREATE TABLE tipo_medida
(
nombre varchar(50) not null unique,
PRIMARY KEY(nombre)
);

CREATE TABLE medida
(
id_medida serial,
fecha_toma timestamp not null,
fecha_registro timestamp default 'now()' not null,
geometria geometry(Point, 4326) not null,
banda smallint not null,
valor_medido decimal(30,20) not null,
id_sensor varchar not null,
tipo varchar(50) not null,
comentario varchar(100) null,
PRIMARY KEY(fecha_toma),
FOREIGN KEY(id_sensor) REFERENCES sensor(id_sensor),
FOREIGN KEY(tipo) REFERENCES tipo_medida(nombre)
);